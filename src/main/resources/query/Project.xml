<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dotori.client.project.dao.ProjectDao">
	<select id="getPatterns" resultType="Project" parameterType="String">
				SELECT 
		    project_pattern2
		FROM 
		    project_pattern where project_pattern1 = #{project_pattern1}
	</select>
	<select id="getProjectPKNum" resultType="int">
		select 
    		project_seq.nextval from dual
	</select>
	
	<update id="createContentTable" parameterType="Project">
		CREATE TABLE ${content_table_name} 
(
	Content_num          NUMBER NOT NULL ,          
	Project_num          NUMBER NOT NULL ,          
	Content_name         VARCHAR2(20) NOT NULL ,    
    Content_Kind         NUMBER NOT NULL ,          
	Content_MinPrice     NUMBER NOT NULL ,          
	Content_RecDate      DATE DEFAULT sysdate,      
	option_table_name    VARCHAR2(30) NULL ,        
    CONSTRAINT content_pk PRIMARY KEY(Content_num)
) 
	</update>
	<update id="createReplyTable" parameterType="Project">
	CREATE TABLE ${reply_table_name} 
(
	reply_num            NUMBER NOT NULL ,          
	Project_num          NUMBER NOT NULL ,          
	Member_id            VARCHAR2(20) NOT NULL ,    
	reply_content        VARCHAR2(1000) NOT NULL ,  
	reply_RecDate        DATE DEFAULT sysdate ,     
    CONSTRAINT reply_pk PRIMARY KEY (reply_num)
)
	
	</update>
	<update id="createOptionTable" parameterType="Project">
	CREATE TABLE ${option_table_name} 
(
	Project_num          NUMBER NOT NULL ,          --프로젝트 번호
	Content_num          NUMBER NOT NULL ,          --제품번호
	option_name          VARCHAR2(10) NOT NULL ,    --옵션명
	option_kind          NUMBER NOT NULL ,          --옵션종류 0 = 선택옵션, 1 = 입력옵션
	option_value         VARCHAR2(10) NOT NULL ,    --옵션값
    CONSTRAINT option_pk  PRIMARY KEY (Project_num)
)
	
	</update>
	<update id="createQna_boardTable" parameterType="Project">
	CREATE TABLE ${qna_board_table_name} 
(
	QNA_num              number NOT NULL ,
	QNA_title            VARCHAR2(30) NOT NULL ,
	QNA_content          VARCHAR2(1000) NOT NULL ,
	Member_id            VARCHAR2(20) NOT NULL ,
	QNA_RegDate          date DEFAULT sysdate ,
	QNA_mDate            DATE DEFAULT sysdate ,
	QNA_REPROOT          NUMBER NULL ,
	QNA_REPINDENT        NUMBER NULL ,
	QNA_hidden           NUMBER not null ,
    CONSTRAINT  QNA_Board_pk PRIMARY KEY (QNA_num)
) 
	
	</update>
	<update id="createQna_boardTableSeq" parameterType="Project">
		create sequence ${qna_board_table_name}_seq 
		start with 1 
		increment by 1 
		MINVALUE 1 
		cache 2
	</update>
	<update id="createReplyTableSeq" parameterType="Project">
		create sequence ${reply_table_name}_seq 
		start with 1 
		increment by 1 
		MINVALUE 1 
		cache 2
	</update>
	<update id="createContentTableSeq" parameterType="Project">
		create sequence ${content_table_name}_seq 
		start with 1 
		increment by 1 
		MINVALUE 1 
		cache 2
	</update>
	<insert id="insertProject" parameterType="Project">
		INSERT INTO project (
    project_num,
    project_name,
    project_thumb,
    project_summary,
    project_pattern1,
    project_pattern2,
    project_url,
    project_targetmoney,
    project_enddate,
    project_content,
    project_bank,
    project_banknum,
    content_table_name,
    qna_board_table_name,
    option_table_name,
    reply_table_name,
    member_id
) VALUES (
    #{project_num},
    #{project_name},
    #{project_thumb},
    #{project_summary},
    #{project_pattern1},
    #{project_pattern2},
    #{project_url},
    #{project_targetmoney},
    #{project_enddate},
    #{project_content},
    #{project_bank},
    #{project_banknum},
    #{content_table_name},
    #{qna_board_table_name},
    #{option_table_name},
    #{reply_table_name},
    #{member_id}
)
	</insert>
	
	<insert id="insertProjectContentTable" parameterType="InsertContentVO">
	INSERT INTO ${tableName} (
    content_num,
    project_num,
    content_name,
    content_kind,
    content_minprice,
    option_table_name
) VALUES (
    ${tableName}_seq.nextval,
    #{project_num},
    #{content_name},
    #{content_kind},
    #{content_minprice},
    #{option_table_name}
)
	</insert>
</mapper>